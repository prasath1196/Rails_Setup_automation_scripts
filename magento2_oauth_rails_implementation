class MagentoAuthenticationsController < ApplicationController
    # Action where user is redirected by magento to link the rails app.Put this 
    # route in the identity URL text box in magento admin panel.
    def oauth_identity
        # URL passed as params by magento to redirect user to the integration 
        # grid after oauth handshake is complete.
        @success_callback =  URI.decode(params[:success_call_back])
        respond_to do |format|
          format.html
        end
    end
    # Action where magento posts the following credentials.
    # 1.Consumer key    -> Generated by magento. Check inside the integration 
    #                      that you have created.
    # 2.Consumer secret -> Generated by magento. Check inside the integration 
    #                      that you have created.
    # 3.Store base url  -> Your store's base URL.
    # 4.Oauth verifier  -> Used in obtaining access token.
    # Add the route of this action in the callback URL text box inside the 
    # integration\
    def oauth_callback
        consumer_key = params['oauth_consumer_key']
        consumer_secret = params['oauth_consumer_secret']
        oauth_verifier =  params['oauth_verifier']
        # URL to post request,to obtain request token(specified by magento)
        uri = 'http://your-host/oauth/token/request'
        consumer = OAuth::Consumer.new(consumer_key,consumer_secret,
                                        :site => uri)
        request_token = consumer.get_request_token
        session[:token] = request_token.token
        session[:token_secret] = request_token.secret
        hash = { oauth_token: session[:token], 
                 oauth_token_secret: session[:token_secret]}
        # URL to post request,to obtain access token(specified by magento)
        uri = 'http://your-host/oauth/token/access'
        consumer = OAuth::Consumer.new(consumer_key,consumer_secret, 
                                       :site => uri)
        request_token  = OAuth::RequestToken.from_hash(consumer, hash)
        access_token = request_token.get_access_token(
                                                 oauth_verifier: oauth_verifier)
    end
end

###############################################################################

# IDENTITY URL VIEW (View of pop-up for the identity linking that is opened 
# once 'Allow' is clicked in magento. Add a redirect to integrations grid here

<%= link_to "Click Here to complete the integration process",
    @success_callback %>
  

